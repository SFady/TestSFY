{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 40, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/BMenez/Documents/Site/testsfy/src/lib/db.js"],"sourcesContent":["import { neon } from '@neondatabase/serverless';\r\n\r\nconst sql = neon(process.env.DATABASE_URL);\r\n\r\nexport default sql;\r\n"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM,MAAM,IAAA,gKAAI,EAAC,QAAQ,GAAG,CAAC,YAAY;uCAE1B"}},
    {"offset": {"line": 52, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/BMenez/Documents/Site/testsfy/src/app/api/insert-sell/route.js"],"sourcesContent":["import sql from '@/lib/db';\r\n\r\nexport async function POST(req) {\r\n  try {\r\n\r\n    const formData = await req.formData();\r\n\r\n    const dt = formData.get(\"date_sell\");\r\n    const total_defit_amount = formData.get(\"defit_amount\");\r\n\r\n    let result = await sql`SELECT * FROM user_activities where date_claimed<=${dt} and defit_value is null and user_id=1 order by date_claimed`;\r\n\r\n    let total=0;\r\n    let id=-1;\r\n    let difference=0;\r\n    for (const row of result) {\r\n      total+=Number(row.defit_amount);\r\n      if (total>Number(total_defit_amount)){\r\n        id=Number(row.id);\r\n        if (total!=Number(total_defit_amount))\r\n        {\r\n          difference=total-Number(total_defit_amount);\r\n        }\r\n        break; \r\n      }   \r\n    }\r\n\r\n    if (id!=-1)\r\n    {\r\n       result = await sql`update user_activities set defit_value=1, defit_difference=0 where date_claimed<=${dt} and defit_value is null and user_id=1 and id<${id}`;  \r\n       if (difference != 0 )\r\n       {\r\n          result = await sql`update user_activities set defit_value=1, defit_difference=${difference} where date_claimed<=${dt} and defit_value is null and user_id=1 and id=${id}`;   \r\n       }\r\n    }\r\n    \r\n\r\n\r\n\r\n    return Response.json({ message: '✅ Calc OK', result: id });\r\n    \r\n  } catch (err) {\r\n    console.error('❌ DB error:', err);\r\n    return new Response(JSON.stringify({ result: 0, error: err.message }), {\r\n      status: 500,\r\n      headers: { \"Content-Type\": \"application/json\" },\r\n    });\r\n  }\r\n}\r\n\r\n"],"names":[],"mappings":";;;;AAAA;;AAEO,eAAe,KAAK,GAAG;IAC5B,IAAI;QAEF,MAAM,WAAW,MAAM,IAAI,QAAQ;QAEnC,MAAM,KAAK,SAAS,GAAG,CAAC;QACxB,MAAM,qBAAqB,SAAS,GAAG,CAAC;QAExC,IAAI,SAAS,MAAM,6HAAG,CAAC,kDAAkD,EAAE,GAAG,4DAA4D,CAAC;QAE3I,IAAI,QAAM;QACV,IAAI,KAAG,CAAC;QACR,IAAI,aAAW;QACf,KAAK,MAAM,OAAO,OAAQ;YACxB,SAAO,OAAO,IAAI,YAAY;YAC9B,IAAI,QAAM,OAAO,qBAAoB;gBACnC,KAAG,OAAO,IAAI,EAAE;gBAChB,IAAI,SAAO,OAAO,qBAClB;oBACE,aAAW,QAAM,OAAO;gBAC1B;gBACA;YACF;QACF;QAEA,IAAI,MAAI,CAAC,GACT;YACG,SAAS,MAAM,6HAAG,CAAC,iFAAiF,EAAE,GAAG,8CAA8C,EAAE,GAAG,CAAC;YAC7J,IAAI,cAAc,GAClB;gBACG,SAAS,MAAM,6HAAG,CAAC,2DAA2D,EAAE,WAAW,qBAAqB,EAAE,GAAG,8CAA8C,EAAE,GAAG,CAAC;YAC5K;QACH;QAKA,OAAO,SAAS,IAAI,CAAC;YAAE,SAAS;YAAa,QAAQ;QAAG;IAE1D,EAAE,OAAO,KAAK;QACZ,QAAQ,KAAK,CAAC,eAAe;QAC7B,OAAO,IAAI,SAAS,KAAK,SAAS,CAAC;YAAE,QAAQ;YAAG,OAAO,IAAI,OAAO;QAAC,IAAI;YACrE,QAAQ;YACR,SAAS;gBAAE,gBAAgB;YAAmB;QAChD;IACF;AACF"}}]
}