{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 40, "column": 0}, "map": {"version":3,"sources":["file:///c:/Users/BMenez/Documents/site/testsfy/src/lib/db.js"],"sourcesContent":["import { neon } from '@neondatabase/serverless';\r\n\r\nconst sql = neon(process.env.DATABASE_URL);\r\n\r\nexport default sql;\r\n"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM,MAAM,IAAA,gKAAI,EAAC,QAAQ,GAAG,CAAC,YAAY;uCAE1B"}},
    {"offset": {"line": 52, "column": 0}, "map": {"version":3,"sources":["file:///c:/Users/BMenez/Documents/site/testsfy/src/app/api/get-users-activities/route.js"],"sourcesContent":["import sql from '@/lib/db';\r\n\r\nexport async function GET(req) {\r\n  try {\r\n    const url = new URL(req.url);\r\n    const userId = Number(url.searchParams.get(\"userId\")) || 0;\r\n\r\n    let result;\r\n    \r\n    if (userId === 0) {\r\n      result = await sql`\r\n        select \r\n          uac.id, \r\n          uac.date_claimed, \r\n          usr.name as user_name, \r\n          act.name as activity_name, \r\n          uac.defit_amount, \r\n          uac.participation_percentage,\r\n          uac.boost\r\n        from user_activities uac\r\n        inner join users usr on uac.user_id = usr.id\r\n        inner join activity_type act on uac.activity_type = act.id\r\n        order by uac.date_claimed desc;\r\n      `;\r\n    } else {\r\n      result = await sql`\r\n        select \r\n          uac.id, \r\n          uac.date_claimed, \r\n          usr.name as user_name, \r\n          act.name as activity_name, \r\n          uac.defit_amount, \r\n          uac.participation_percentage,\r\n          uac.boost\r\n        from user_activities uac\r\n        inner join users usr on uac.user_id = usr.id\r\n        inner join activity_type act on uac.activity_type = act.id\r\n        where uac.user_id = ${userId}\r\n        order by uac.date_claimed desc;\r\n      `;\r\n    }\r\n\r\n    return new Response(JSON.stringify({ result: result }), {\r\n      status: 200,\r\n      headers: { \"Content-Type\": \"application/json\" },\r\n    });\r\n  } catch (err) {\r\n    console.error('❌ DB error:', err);\r\n    return new Response(JSON.stringify({ result: 0, error: err.message }), {\r\n      status: 500,\r\n      headers: { \"Content-Type\": \"application/json\" },\r\n    });\r\n  }\r\n}\r\n\r\n\r\n// SELECT \r\n//     COALESCE(t.value1, 0) AS value1,\r\n//     uas.*\r\n// FROM user_activities uas\r\n// LEFT JOIN LATERAL (\r\n//     SELECT uts.value1\r\n//     FROM user_transactions uts\r\n//     WHERE uts.user_id = uas.user_id\r\n//       AND uts.transaction_date > uas.date_claimed  -- prochaine transaction\r\n//     ORDER BY uts.transaction_date ASC             -- la plus proche après\r\n//     LIMIT 1\r\n// ) t ON TRUE\r\n// WHERE uas.user_id = 1\r\n// ORDER BY uas.date_claimed ASC;\r\n\r\n\r\n// SELECT \r\n//     uac.id, \r\n//     uac.date_claimed, \r\n//     usr.name AS user_name, \r\n//     act.name AS activity_name, \r\n//     uac.defit_amount, \r\n//     uac.participation_percentage,\r\n//     CASE \r\n//         WHEN t.value1 IS NULL OR t.value1 = 0 THEN -1\r\n//         ELSE t.value2 / t.value1\r\n//     END AS ratio\r\n// FROM user_activities uac\r\n// INNER JOIN users usr \r\n//     ON uac.user_id = usr.id\r\n// INNER JOIN activity_type act \r\n//     ON uac.activity_type = act.id\r\n// LEFT JOIN LATERAL (\r\n//     SELECT \r\n//         uts.value1,\r\n//         uts.value2\r\n//     FROM user_transactions uts\r\n//     WHERE uts.user_id = uac.user_id\r\n//       AND uts.transaction_date > uac.date_claimed\r\n//     ORDER BY uts.transaction_date ASC\r\n//     LIMIT 1\r\n// ) t ON TRUE\r\n// ORDER BY uac.date_claimed DESC;"],"names":[],"mappings":";;;;AAAA;;AAEO,eAAe,IAAI,GAAG;IAC3B,IAAI;QACF,MAAM,MAAM,IAAI,IAAI,IAAI,GAAG;QAC3B,MAAM,SAAS,OAAO,IAAI,YAAY,CAAC,GAAG,CAAC,cAAc;QAEzD,IAAI;QAEJ,IAAI,WAAW,GAAG;YAChB,SAAS,MAAM,6HAAG,CAAC;;;;;;;;;;;;;MAanB,CAAC;QACH,OAAO;YACL,SAAS,MAAM,6HAAG,CAAC;;;;;;;;;;;;4BAYG,EAAE,OAAO;;MAE/B,CAAC;QACH;QAEA,OAAO,IAAI,SAAS,KAAK,SAAS,CAAC;YAAE,QAAQ;QAAO,IAAI;YACtD,QAAQ;YACR,SAAS;gBAAE,gBAAgB;YAAmB;QAChD;IACF,EAAE,OAAO,KAAK;QACZ,QAAQ,KAAK,CAAC,eAAe;QAC7B,OAAO,IAAI,SAAS,KAAK,SAAS,CAAC;YAAE,QAAQ;YAAG,OAAO,IAAI,OAAO;QAAC,IAAI;YACrE,QAAQ;YACR,SAAS;gBAAE,gBAAgB;YAAmB;QAChD;IACF;AACF,EAGA,UAAU;CACV,uCAAuC;CACvC,YAAY;CACZ,2BAA2B;CAC3B,sBAAsB;CACtB,wBAAwB;CACxB,iCAAiC;CACjC,sCAAsC;CACtC,8EAA8E;CAC9E,4EAA4E;CAC5E,cAAc;CACd,cAAc;CACd,wBAAwB;CACxB,iCAAiC;CAGjC,UAAU;CACV,eAAe;CACf,yBAAyB;CACzB,8BAA8B;CAC9B,kCAAkC;CAClC,yBAAyB;CACzB,oCAAoC;CACpC,YAAY;CACZ,wDAAwD;CACxD,mCAAmC;CACnC,mBAAmB;CACnB,2BAA2B;CAC3B,wBAAwB;CACxB,8BAA8B;CAC9B,gCAAgC;CAChC,oCAAoC;CACpC,sBAAsB;CACtB,cAAc;CACd,sBAAsB;CACtB,qBAAqB;CACrB,iCAAiC;CACjC,sCAAsC;CACtC,oDAAoD;CACpD,wCAAwC;CACxC,cAAc;CACd,cAAc;CACd,kCAAkC"}}]
}